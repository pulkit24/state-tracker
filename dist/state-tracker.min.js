/*! Angular State Tracker 27-01-2014 */
angular.module("state-tracker",[]),angular.module("state-tracker").factory("stateTracker",["$timeout","$q",function(a,b){function c(a,b){if(!angular.isArray(b)||!b.length)return null;var c,e,g;return angular.forEach(b,function(b){angular.isString(b)?(c=b,e=b,g="is"+f(b)):angular.isObject(b)&&(c=b.state,e=b.set,g=b.check),a=d(a,c,e,g,angular.isUndefined(a._defaultState))}),a}function d(a,b,c,d,f){b=e(b),c=e(c),d=e(d),a._states.indexOf(b)<0&&a._states.push(b);var g=a._states.indexOf(b);return a[c]=function(){return a._setState(g)},a[d]=function(){return a._isState(g)},f&&(a._defaultState=g),a.$revert()}function e(a){return(""+a).replace(/[^a-zA-Z0-9_]/g,"").replace(/^_+/,"")}function f(a){return a.charAt(0).toUpperCase()+a.slice(1)}var g=function(){this._states=[],this._defaultState=void 0,this._state=void 0,this._setState=function(a){return this._notifyUnset(this._states[this._state]),this._state=a,this._notifySet(this._states[a]),this},this._isState=function(a){return this._state===a},this.$revert=function(){return this._setState(this._defaultState)},this.$map=function(a,b,c){var d=c?this._states.indexOf(c):this._state;angular.isUndefined(b)&&(b=0);try{return a[d+b]}catch(e){return null}};var c=[],d=[],e={};this.$on=function(a,b){var f,g=null;return"set"===a.toLowerCase()?(f=c.length,c.push(b)):"unset"===a.toLowerCase()?(f=d.length,d.push(b)):(g=a,e[g]||(e[g]=[]),f=e[g].length,e[g].push(b)),function(){this._unbind(a,f,g)}},this._unbind=function(a,b,f){"set"===a.toLowerCase()?c[b]=angular.noop:"unset"===a.toLowerCase()?d[b]=angular.noop:e[f][b]=angular.noop},this._notify=function(b,c){angular.forEach(b,function(b){a(function(){b(c)},0)})},this._notifyUnset=function(a){this._notify(d,a)},this._notifySet=function(a){this._notify(e[a],a),this._notify(c,a)},this.$transition=function(a,b,c){var d=this,e=angular.isString(a)?a:this._states[a],b=angular.isString(b)?this._states.indexOf(b):b;e&&b>=0&&d.$on("set",function(a){a===e&&d._delay(c).then(function(){d._setState(b)})})},this._delay=function(c){var d=b.defer();return a(function(){d.resolve()},c),d.promise}},h=[{state:"idle",set:"reset",check:"isIdle"},{state:"active",set:"activate",check:"isActive"},{state:"complete",set:"complete",check:"isComplete"},{state:"failed",set:"fail",check:"isFailed"}],i=function(a,b){var d,e;angular.isArray(a)?(d=a,e=b):angular.isUndefined(a)&&angular.isDefined(b)?(d=h,e=b):(d=h,e=a);var f=l(e);if(f)return f;var i=new g;return i=c(i,d),e&&k(e,i),i},j={},k=function(a,b){return j[a]=b,b},l=function(a){return j[a]};return{"new":i,get:l}}]),angular.module("state-tracker").filter("stateTracker",function(){return function(a,b){if(a){if(angular.isArray(b)){var c=a.$map(b);return c?c:b.length>0?b[0]:null}var c=a.$map(arguments,1);return c?c:arguments.length>1?arguments[1]:null}return null}}),angular.module("state-tracker").directive("stateTracker",["stateTracker","$timeout",function(a,b){return{restrict:"EA",scope:{stateTracker:"=",stateRegistrationName:"@stateTracker",stateIsolate:"@",stateChoices:"&",stateClass:"&",stateOnChange:"&",stateOnIdle:"&",stateOnActive:"&",stateOnComplete:"&",stateOnFailed:"&",stateReset:"&",stateActivate:"&",stateComplete:"&",stateFail:"&",stateTransition:"&"},link:function(c,d){c.stateIsolate&&"false"!==c.stateIsolate&&(c.stateRegistrationName=null),c.stateTracker=a.new(c.stateChoices(),c.stateRegistrationName);var e=c.stateClass();c.stateTracker.$on("set",function(a){d.addClass(c.stateTracker.$map(e,0,a))}),c.stateTracker.$on("unset",function(a){d.removeClass(c.stateTracker.$map(e,0,a))}),c.stateTracker.$on("set",function(a){c.stateOnChange&&b(function(){c.stateOnChange({state:a})},0);var d=null;switch(a){case"idle":d=c.stateOnIdle;break;case"active":d=c.stateOnActive;break;case"complete":d=c.stateOnComplete;break;case"failed":d=c.stateOnFailed}d&&b(function(){d()},0)}),c.$watch("stateReset()",function(a){a&&c.stateTracker.reset()}),c.$watch("stateActivate()",function(a){a&&c.stateTracker.activate()}),c.$watch("stateComplete()",function(a){a&&c.stateTracker.complete()}),c.$watch("stateFail()",function(a){a&&c.stateTracker.fail()});var f=c.stateTransition();angular.isDefined(f)&&angular.forEach(f,function(a,b){angular.forEach(a,function(a,d){c.stateTracker.$transition(b,d,a)})}),c.stateTracker.$revert()}}}]);